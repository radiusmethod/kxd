#!/usr/bin/env bash

arg1="$1"
arg2="$2"

run_main() {
  KUBECONFIG="$KUBECONFIG" _kxd_prompt file switch
  selected_config="$(cat ~/.kxd)"

  if [ -z "$selected_config" ]
  then
    unset KUBECONFIG
  else
    export KUBECONFIG="$HOME/.kube/$selected_config"
  fi
}

run_file() {
  case "$arg2" in
    s|switch)
      run_main
      ;;
    *)
      _kxd_prompt "$@"
      return
      ;;
  esac
}

case "$arg1" in
  f|file)
    run_file "$@"
    ;;
  *)
    _kxd_prompt "$@"
    return
    ;;
esac
