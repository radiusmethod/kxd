#!/usr/bin/env bash

run_context() {
  _kxd_prompt context
  return
}

run_list_context() {
  _kxd_prompt list-context
  return
}

run_list_config() {
  _kxd_prompt list
  return
}

display_help() {
  _kxd_prompt help
  return
}

display_version() {
  _kxd_prompt version
  return
}

run_main() {
  KUBECONFIG="$KUBECONFIG" _kxd_prompt
  selected_config="$(cat ~/.kxd)"

  if [ -z "$selected_config" ]
  then
    unset KUBECONFIG
  else
    export KUBECONFIG="$HOME/.kube/$selected_config"
  fi
}

arg=$(echo "$1" | tr '[:upper:]' '[:lower:]')

case "$arg" in
  -c|--c|context)
    run_context
    ;;
  -l|--l|list)
    run_list_config
    ;;
  -lc|--lc|list-context)
    run_list_context
    ;;
  -h|--h|help)
    display_help
    ;;
  -s|--s|switch)
    run_main
    ;;
  -v|--v|version)
    display_version
    ;;
  *)
    run_main
    ;;
esac
